{% extends "status_board/base.html" %}
{% load static %}
 <!--for testing purposes, mainContent should be changed to cssLink and h1 tags removed-->
{% block mainContent %}
  <!--<script src="{% static 'status_board/loggedOut.js' %}"></script>-->
    {% if user.is_authenticated and perms.catalog.has_write_access %}
        <span>Auth and has permission</span>

    {% elif user.is_authenticated %}
        <span> No permission</span>
        <link rel="stylesheet" type="text/css" href="{% static 'status_board/authenticated.css' %}">
    {% elif not user.is_authenicated %}
        <span>Not Auth</span>
           <!--<script src="{% static 'status_board/loggedOut.js' %}"></script>-->
        <link rel="stylesheet" type="text/css" href="{% static 'status_board/notAuthenticated.css' %}">
    {% endif %}

{% endblock mainContent%}

{% block content %}
  <div class="row no-gutters">
      <!--Bridge Table 1st Column-->
    <div class="col-sm" id="bridgeRow">
        <div class="max-vh-100">
            <table class="table table-striped table-dark ">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Bridge</th>
                      <th scope="col">PCA</th>
                      <th scope="col">GPU</th>
                    </tr>
                  </thead>
                  <tbody>

                    {% for bridge in bridges %}
                        <tr>

                          <th scope="row">
                              <a href="{% url 'bridgeTableForm' btID=bridge.bridgeTableID%}" class="disabled">
                                  <span>{{bridge.bridgeTableID}} </span>
                              </a>
                          </th>
                          <td>
                              {% if bridge.Bridge_Status_Choice == 'GREEN' %}

                                    <img src='{% static "status_board/images/green.png" %}' alt="My image" class="bridge {{bridge.bridgeTableID}}">

                              {% elif bridge.Bridge_Status_Choice == 'RED' %}
                                 <img src='{% static "status_board/images/red.png" %}' alt="My image" class="bridge {{bridge.bridgeTableID}}">
                              {% else %}
                                     <img src='{% static "status_board/images/yellow.png" %}' alt="My image" class="bridge {{bridge.bridgeTableID}}">
                              {% endif %}
                          </td>
                          <td>
                              {% if bridge.PCA_Status_Choice == 'GREEN' %}
                                  <img src='{% static "status_board/images/green.png" %}' alt="My image" class="PCA {{bridge.bridgeTableID}}">
                              {% elif bridge.PCA_Status_Choice == 'RED' %}
                                 <img src='{% static "status_board/images/red.png" %}' alt="My image" class="PCA {{bridge.bridgeTableID}}">
                              {% else %}
                                     <img src='{% static "status_board/images/yellow.png" %}' alt="My image" class="PCA {{bridge.bridgeTableID}}">
                              {% endif %}
                          </td>
                          <td>
                              {% if bridge.GPU_Status_Choice == 'GREEN' %}
                                  <img src='{% static "status_board/images/green.png" %}' alt="My image" class="GPU {{bridge.bridgeTableID}}">
                              {% elif bridge.GPU_Status_Choice == 'RED' %}
                                 <img src='{% static "status_board/images/red.png" %}' alt="My image" class="GPU {{bridge.bridgeTableID}}">
                              {% else %}
                                     <img src='{% static "status_board/images/yellow.png" %}' alt="My image" class="GPU {{bridge.bridgeTableID}}">
                              {% endif %}
                          </td>
                        </tr>
                    {% endfor %}
                  </tbody>
                </table>
            </div>
    </div>

    <!--Elevators 2nd Column-->
    
    <div class="col-sm text-white">
      <body style="background-color:black">
        <div class="border" id="elevators">
        <p style="text-align:center">Elevators</p>
        <div class="d-flex flex-wrap justify-content-around" style="background-color:black">
              {% for elev in elevators %}
                <div class="p-2" style="margin:10px; height:100px;" >
                  <a href="{% url 'elevatorForm' btID=elev.elevatorID%}" class="disabled">
                    <span>{{elev.elevatorID}}</span>
                  </a>
                      {% if elev.Elevator_Status_Choice == 'GREEN' %}
                            <img src='{% static "status_board/images/greenElev.png" %}' alt="My image" class="Elev {{elev.elevatorID}}">
                      {% elif elev.Elevator_Status_Choice == 'RED' %}
                            <img src='{% static "status_board/images/redElev.png" %}' alt="My image" class="Elev {{elev.elevatorID}}">
                      {% endif %}
                </div>
            {% endfor %}
            </div>
          </div>
          </body>
                  <!--hide when user is not authenticated-->
            <!--DOM / INT PBS-->
            <div  style="height:50vh">
              <div class="bg-dark border" id ="pbs">
                <div class="col notAuth">
  
                     <p style="text-align:center">Pre Board Screening</p>
  
                     {% for dmPBS  in domIntPBS %}
                        <div class="p-2ss" >
                            {% if dmPBS.DomIntPBS_Status_Choice == 'GREEN' %}
                            <h3 class="domPBS {{dmPBS.domIntPBSID}}" style="color:#2ECC71"> <a href="{% url 'domIntPBSForm' btID=dmPBS.domIntPBSID%}" class="disabled" style="color:inherit"> <span>DOM/INT PBS</span>  </a> </h3>
                             {% elif dmPBS.DomIntPBS_Status_Choice == 'YELLOW' %}
                              <h3 class="domBag {{dmPBS.domIntPBSID}}" style="color:#F1C40F"> <a href="{% url 'domIntPBSForm' btID=dmPBS.domIntPBSID%}" class="disabled" style="color:inherit"> <span>DOM/INT PBS</span>  </a>  </h3>
                            {% elif  dmPBS.DomIntPBS_Status_Choice == 'RED' %}
                              <h3 class="domBag {{dmPBS.domIntPBSID}}" style="color:#E74C3C"> <a href="{% url 'domIntPBSForm' btID=dmPBS.domIntPBSID%}" class="disabled" style="color:inherit"> <span>DOM/INT PBS</span>  </a>  </h3>
                            {% endif %}
                        </div>
  
                     {% endfor %}
                </div>
  
             <!-- Yellow selection does not work for below!!!!-->
             <!-- TB PBS System-->
                <div class="col notAuth">
                     {% for tPBS in tbPBS %}
                        <div class="p-2" >
                            {% if tPBS.TbPBS_Status_Choice == 'GREEN' %}
                            <h3 class="tPBS {{tPBS.tbPBSID}}" style="color:#2ECC71"> <a href="{% url 'tbPBSForm' btID=tPBS.tbPBSID%}" class="disabled" style="color:inherit"> <span>TB PBS</span></a> </h3>
                             {% elif tPBS.TbPBS_Status_Choice == 'YELLOW' %}
                              <h3 class="tPBS {{tPBS.tbPBSID}}" style="color:#F1C40F"> <a href="{% url 'tbPBSForm' btID=tPBS.tbPBSID%}" class="disabled" style="color:inherit"> <span>TB PBS</span></a> </h3>
                            {% elif  tPBS.TbPBS_Status_Choice == 'RED' %}
                              <h3 class="tPBS {{tPBS.tbPBSID}}" style="color:#E74C3C"> <a href="{% url 'tbPBSForm' btID=tPBS.tbPBSID%}" class="disabled" style="color:inherit"> <span>TB PBS</span></a> </h3>
                            {% endif %}
                        </div>
  
                     {% endfor %}
                </div>
              </div>

              <!-- Other Systems-->
                <!-- Lav Hut -->
                <div class="border" style="background-color: black" id ="other">
                  <p style="text-align:center">Other Systems</p>
                <div class="col notAuth">
                  {% for lHut in lavHut %}
                     <div class="p-2" >
                         {% if lHut.LavHut_Status_Choice == 'GREEN' %}
                         <h3 class="lHut {{lHut.lavHutID}}" style="color: #2ECC71"> <a href="{% url 'lavHutForm' btID=lHut.lavHutID%}" class="disabled" style="color:inherit"> <span>LAV HUT</span></a> </h3>
                          {% elif lHut.LavHut_Status_Choice == 'YELLOW' %}
                           <h3 class="lHut {{lHut.lavHutID}}" style="color:#F1C40F"> <a href="{% url 'lavHutForm' btID=lHut.lavHutID%}" class="disabled" style="color:inherit"> <span>LAV HUT</span></a> </h3>
                         {% elif  lHut.LavHut_Status_Choice == 'RED' %}
                           <h3 class="lHut {{lHut.lavHutID}}" style="color:#E74C3C"> <a href="{% url 'lavHutForm' btID=lHut.lavHutID%}" class="disabled" style="color:inherit"> <span>LAV HUT</span></a> </h3>
                         {% endif %}
                     </div>
  
                  {% endfor %}
             </div>
             <!-- Water Fill -->
             <div class="col notAuth">
              {% for wFill in waterFill %}
                 <div class="p-2" >
                     {% if wFill.WaterFill_Status_Choice == 'GREEN' %}
                     <h3 class="wFill {{wFill.waterFillID}}" style="color: #2ECC71"> <a href="{% url 'waterFillForm' btID=wFill.waterFillID%}" class="disabled" style="color:inherit"> <span>WATER FILL</span></a> </h5>
                      {% elif wFill.WaterFill_Status_Choice == 'YELLOW' %}
                       <h3 class="wFill {{wFill.waterFillID}}" style="color:#F1C40F"> <a href="{% url 'waterFillForm' btID=wFill.waterFillID%}" class="disabled" style="color:inherit"> <span>WATER FILL</span></a> </h5>
                     {% elif  wFill.WaterFill_Status_Choice == 'RED' %}
                       <h3 class="wFill {{wFill.waterFillID}}" style="color:#E74C3C"> <a href="{% url 'waterFillForm' btID=wFill.waterFillID%}" class="disabled" style="color:inherit"> <span>WATER FILL</span></a> </h5>
                     {% endif %}
                 </div>
  
              {% endfor %}
         </div>
        </div>
        </div>
  
      </div>
             
    
    
    <!--Escalators 3rd Column-->
    <div class="col-sm">
        <div class="border bg-dark text-white" id="escalators" style="height:50vh">
      <p style="text-align:center">Escalators</p>

        <div class="d-flex flex-wrap justify-content-around text-white">
            
              {% for esc in escalators %}
                <div class="p-2" style="flex:1 0 21%; height:100px;">
                    <a href="{% url 'escalatorForm' btID=esc.escalatorID%}" class="disabled">
                        <span>{{esc.escalatorID}}</span>
                    </a>
                      {% if esc.Escalator_Status_Choice == 'GREEN' %}
                            <img src='{% static "status_board/images/greenEsc.png" %}' alt="My image" class="Esc {{esc.escalatorID}} ">
                      {% elif esc.Escalator_Status_Choice == 'RED' %}
                            <img src='{% static "status_board/images/redEsc.png" %}' alt="My image" class="Esc {{esc.escalatorID}}">
                      {% endif %}
                </div>
            {% endfor %}
            </div>
            </div>

             <!--hide when user is not authenticated-->
            <!--DOM / INT Baggage System-->
        <div  style="height:50vh">
           <div class ="border white-text" id="baggagge">
            <div class="col notAuth">
  
                 <p style="text-align:center">Baggage</p>
  
                 {% for domIntBag in domIntBaggage %}
                    <div class="p-2" >
                        {% if domIntBag.DomIntBaggage_Status_Choice == 'GREEN' %}
                        <h3 class="domBag {{domIntBag.domIntBaggageID}}" style="color:#2ECC71"> <a href="{% url 'domIntBaggageForm' btID=domIntBag.domIntBaggageID%}" class="disabled" style="color:inherit"> <span>DOM/INT BAGGAGE SYSTEM</span>  </a> </h3>
                         {% elif domIntBag.DomIntBaggage_Status_Choice == 'YELLOW' %}
                          <h3 class="domBag {{domIntBag.domIntBaggageID}}" style="color:#F1C40F"> <a href="{% url 'domIntBaggageForm' btID=domIntBag.domIntBaggageID%}" class="disabled" style="color:inherit"> <span>DOM/INT BAGGAGE SYSTEM</span>  </a>  </h3>
                        {% elif  domIntBag.DomIntBaggage_Status_Choice == 'RED' %}
                          <h3 class="domBag {{domIntBag.domIntBaggageID}}" style="color:#E74C3C"> <a href="{% url 'domIntBaggageForm' btID=domIntBag.domIntBaggageID%}" class="disabled" style="color:inherit"> <span>DOM/INT BAGGAGE SYSTEM</span>  </a>  </h3>
                        {% endif %}
                    </div>
  
                 {% endfor %}
            </div>
  
         <!-- TB Baggage System-->
            <div class="col notAuth">
                 {% for tbBag in tbBaggage %}
                    <div class="p-2" >
                        {% if tbBag.TbBaggage_Status_Choice == 'GREEN' %}
                        <h3 class="tbBag {{tbBag.tbBaggageID}}" style="color:#2ECC71"> <a href="{% url 'tbBaggageSystemsForm' btID=tbBag.tbBaggageID%}" class="disabled" style="color:inherit"> <span>TB BAGGAGE SYSTEM</span></a> </h3>
                         {% elif tbBag.TbBaggage_Status_Choice == 'YELLOW' %}
                          <h3 class="tbBag {{tbBag.tbBaggageID}}" style="color:#F1C40F"> <a href="{% url 'tbBaggageSystemsForm' btID=tbBag.tbBaggageID%}" class="disabled" style="color:inherit"> <span>TB BAGGAGE SYSTEM</span></a> </h3>
                        {% elif  tbBag.TbBaggage_Status_Choice == 'RED' %}
                          <h3 class="tbBag {{tbBag.tbBaggageID}}" style="color:#E74C3C"> <a href="{% url 'tbBaggageSystemsForm' btID=tbBag.tbBaggageID%}" class="disabled" style="color:inherit"> <span>TB BAGGAGE SYSTEM</span></a> </h3>
                        {% endif %}
                    </div>
  
                 {% endfor %}
            </div>
  
                 <!-- DOM / INT Baggage Oversize -->
            <div class="col notAuth">
                 {% for domOversize in domIntOversize %}
                    <div class="p-2" >
                        {% if domOversize.DomIntOversize_Status_Choice == 'GREEN' %}
                        <h3 class="domBagOver {{domOversize.domIntOversizeID}}" style="color:#2ECC71"><a href="{% url 'domIntOversizeForm' btID=domOversize.domIntOversizeID%}" class="disabled" style="color:inherit"> <span> DOM / INT OVERSIZE</span></a> </h3>
                         {% elif domOversize.DomIntOversize_Status_Choice == 'YELLOW' %}
                          <h3 class="domBagOver {{domOversize.domIntOversizeID}}" style="color:#F1C40F"> <a href="{% url 'domIntOversizeForm' btID=domOversize.domIntOversizeID%}" class="disabled" style="color:inherit"> <span> DOM / INT OVERSIZE</span></a> </h3>
                        {% elif  domOversize.DomIntOversize_Status_Choice == 'RED' %}
                          <h3 class="domBagOver {{domOversize.domIntOversizeID}}" style="color:#E74C3C"><a href="{% url 'domIntOversizeForm' btID=domOversize.domIntOversizeID%}" class="disabled" style="color:inherit"> <span> DOM / INT OVERSIZE</span></a> </h3>
                        {% endif %}
                    </div>
  
                 {% endfor %}
            </div>
  
                    <!-- TB Oversize -->
                 <div class="col notAuth">
  
  
                 {% for tbOver in tbOversize %}
                    <div class="p-2" >
                        {% if tbOver.TbOversize_Status_Choice == 'GREEN' %}
                             <h3 class="tbOver {{tbOver.tbOversizeID}}" style="color:#2ECC71"> <a href="{% url 'tbOversizeForm' btID=tbOver.tbOversizeID%}" style="color:inherit" class="disabled"> <span>TB OVERSIZE</span> </a>  </h3>
                         {% elif tbOver.TbOversize_Status_Choice == 'YELLOW' %}
                          <h3 class="tbOver {{tbOver.tbOversizeID}}" style="color:#F1C40F"> <a href="{% url 'tbOversizeForm' btID=tbOver.tbOversizeID%}" style="color:inherit" class="disabled"> <span>TB OVERSIZE</span> </a> </h3>
                        {% elif  tbOver.TbOversize_Status_Choice == 'RED' %}
                          <h3 class="tbOver {{tbOver.tbOversizeID}}" style="color:#E74C3C"> <a href="{% url 'tbOversizeForm' btID=tbOver.tbOversizeID%}" style="color:inherit" class="disabled"> <span>TB OVERSIZE</span> </a> </h3>
                        {% endif %}
                    </div>
  
                 {% endfor %}
            </div>
          </div>
          </div>
        

    </div>

  </div>

<script>

var loc = window.location
//var form = $('#formData')
var wsStart = 'ws://'
if (loc.protocol == 'https:'){
    wsStart = 'wss://'
}
var endpoint = wsStart + loc.host + loc.pathname
console.log(loc.host)
console.log(loc.pathname)

 var socket = new WebSocket(endpoint)

   socket.onmessage = function(e){
     console.log('messageeeeeeeeee',e)

            var green = '#2ECC71'
            var yellow = '#F1C40F'
            var red = '#E74C3C'
        var data = JSON.parse(e.data)
        if (data.fromCon == 'bridgeTable'){
                var bridgeTableId = data.bridgeTableID
                var bridgeStat = data.bridgeStat
                var pcaStat = data.pcaStat
                var gpuStat = data.gpuStat




                    var bridge = 'bridge ' + bridgeTableId
                    var pca = 'PCA ' + bridgeTableId
                    var gpu = 'GPU ' + bridgeTableId

                    <!--alert(bridge)-->
                     <!--alert(pca)-->
                      <!--alert(gpu)-->
                    <!--bridge = bridge.toString()-->
                    <!--pca = pca.toString()-->
                    <!--gpu = gpu.toString()-->

                   var bridgeIMG = document.getElementsByClassName(bridge)[0]
                   //console.log('brigeIMG ' + bridgeIMG)
                   var pcaIMG = document.getElementsByClassName(pca)[0]
                   var gpuIMG = document.getElementsByClassName(gpu)[0]

                    //  alert('about to change pic')
                    if (bridgeStat == 'GREEN')
                        bridgeIMG.setAttribute("src","{% static 'status_board/images/green.png'%}")
                     else if (bridgeStat == 'YELLOW')
                        bridgeIMG.setAttribute("src","{% static 'status_board/images/yellow.png'%}")
                     else if (bridgeStat == 'RED')
                        bridgeIMG.setAttribute("src","{% static 'status_board/images/red.png'%}")

                     if (pcaStat == 'GREEN')
                        pcaIMG.setAttribute("src","{% static 'status_board/images/green.png'%}")
                     else if (pcaStat == 'YELLOW')
                        pcaIMG.setAttribute("src","{% static 'status_board/images/yellow.png'%}")
                     else if (pcaStat == 'RED')
                        pcaIMG.setAttribute("src","{% static 'status_board/images/red.png'%}")

                     if (gpuStat     == 'GREEN')
                        gpuIMG.setAttribute("src","{% static 'status_board/images/green.png'%}")
                     else if (gpuStat == 'YELLOW')
                        gpuIMG.setAttribute("src","{% static 'status_board/images/yellow.png'%}")
                     else if (gpuStat == 'RED')
                        gpuIMG.setAttribute("src","{% static 'status_board/images/red.png'%}")
        }
        else if (data.fromCon == 'elevator'){
             var elevatorID = data.elevatorID
                var elevatorStat = data.elevatorStat

                var elev = 'Elev ' + elevatorID

                 var elevIMG = document.getElementsByClassName(elev)[0]
                  if (elevatorStat == 'GREEN')
                        elevIMG.setAttribute("src","{% static 'status_board/images/greenElev.png'%}")
                     else if (elevatorStat == 'RED')
                        elevIMG.setAttribute("src","{% static 'status_board/images/redElev.png'%}")
        }
        else if (data.fromCon == 'domIntBag'){
            var domIntBagID = data.domIntBagId
            var domIntBagStat = data.domIntBagStat

            var domIntBag = 'domBag ' + domIntBagID

            var domIntBagTXT = document.getElementsByClassName(domIntBag)[0]

                 if (domIntBagStat == 'GREEN')
                        domIntBagTXT.style.color = green
                   else if (domIntBagStat == 'YELLOW')
                        domIntBagTXT.style.color = yellow
                     else if (domIntBagStat == 'RED')
                        domIntBagTXT.style.color = red
        }

        else if (data.fromCon == 'tbBag'){
            var tbBagID = data.tbBagID
            var tbBagStat = data.tbBagStat

            var tbBag = 'tbBag ' + tbBagID

            var tbBagTXT = document.getElementsByClassName(tbBag)[0]

                 if (tbBagStat == 'GREEN')
                        tbBagTXT.style.color = green
                   else if (tbBagStat == 'YELLOW')
                        tbBagTXT.style.color = yellow
                     else if (tbBagStat == 'RED')
                        tbBagTXT.style.color = red
        }
        else if (data.fromCon == 'domIntOversize'){
            var domIntOversizeID = data.domIntOversizeID
            var domIntOversizeStat = data.domIntOversizeStat

            var domIntOversize = 'domBagOver ' + domIntOversizeID

            var domIntOverTXT = document.getElementsByClassName(domIntOversize)[0]

                 if (domIntOversizeStat == 'GREEN')
                        domIntOverTXT.style.color = green
                   else if (domIntOversizeStat == 'YELLOW')
                        domIntOverTXT.style.color = yellow
                     else if (domIntOversizeStat == 'RED')
                        domIntOverTXT.style.color = red
        }
        else if (data.fromCon == 'tbOversize'){
            var tbOversizeID = data.tbOversizeID
            var tbOversizeStatus = data.tbOversizeStatus

            var tbOversize = 'tbOver ' + tbOversizeID

            var tbBagOverTXT = document.getElementsByClassName(tbOversize)[0]

                 if (tbOversizeStatus == 'GREEN')
                        tbBagOverTXT.style.color = green
                   else if (tbOversizeStatus == 'YELLOW')
                        tbBagOverTXT.style.color = yellow
                     else if (tbOversizeStatus == 'RED')
                        tbBagOverTXT.style.color = red
        }




           <!--console.log(index)-->
          <!--var index = $('#newTing')-->
         <!--index.attr("src",'{% static "systems/green.png" %}')-->
    }

    socket.onopen = function(e){
        console.log('opennnnnnnnnnnnn',e)
        }

socket.onerror = function(e){
console.log('error',e)
}
socket.onclose = function(e){
console.log('closedddddddddddddddddd',e)
}

</script>

{% endblock content %}
